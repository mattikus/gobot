package modules

import (
	"context"
	"fmt"
	"math/rand"
	"strings"

	"github.com/spy16/snowman"
)

// emojiList is a slice of strings representing emoji names for Slack.
type emojiList []string

// rand returns a random emoji from the emojiList.
func (e emojiList) rand(count int) []string {
	var out []string
	for i := 0; i < count; i++ {
		out = append(out, e[rand.Intn(len(e))])
	}
	return out
}

// Random implements a snowman.ProcessorFunc which returns a random emoji from the emojiList.
func (e emojiList) Random(_ context.Context, intent snowman.Intent) (snowman.Msg, error) {
	return snowman.Msg{
		Body:    fmt.Sprintf(":%v:", e.rand(1)[0]),
		Attribs: intent.Msg.Attribs,
	}, nil
}

// Spin implements a snowman.ProcessorFunc which plays a little gambling game, creating a subset of
// emoji as a pool and then seeing if you can get 3 of the same emoji. It functions smilar to a slot
// machine.
func (e emojiList) Spin(_ context.Context, intent snowman.Intent) (snowman.Msg, error) {
	pool := emojiList(e.rand(4))
	var results []string
	for x := 0; x < 3; x++ {
		results = append(results, pool.rand(1)...)
	}
	// Determine if all 3 emoji are unique by creating a basic set.
	seen := make(map[string]bool)
	for i, e := range results {
		seen[e] = true
		results[i] = fmt.Sprintf(":%v:", e)
	}
	msg := strings.Join(results, "|")
	if winner := len(seen) == 1; winner {
		msg += " : A winner is you!"
	} else {
		msg += " : You lose! Good day, sir!"
	}
	return snowman.Msg{
		Body:    msg,
		Attribs: intent.Msg.Attribs,
	}, nil
}

func init() {
	Reply(`emoji(?: me)?$`, "emoji.random", emoji.Random)
	Reply(`emoji spin(?: me)?`, "emoji.spin", emoji.Spin)
}

// emoji is an instance of an emojiList with a common set of emoji used in most Slacks.
var emoji = emojiList{
	"+1",
	"-1",
	"8ball",
	"aerial_tramway",
	"airplane",
	"alarm_clock",
	"alien",
	"ambulance",
	"anchor",
	"angel",
	"anger",
	"angry",
	"anguished",
	"ant",
	"apple",
	"art",
	"articulated_lorry",
	"astonished",
	"atm",
	"baby",
	"baby_bottle",
	"baby_chick",
	"balloon",
	"bamboo",
	"banana",
	"bank",
	"bar_chart",
	"barber",
	"baseball",
	"basketball",
	"bath",
	"bathtub",
	"battery",
	"bear",
	"beer",
	"beers",
	"beetle",
	"beginner",
	"bell",
	"bento",
	"bicyclist",
	"bike",
	"bikini",
	"bird",
	"birthday",
	"black_joker",
	"black_nib",
	"blossom",
	"blowfish",
	"blue_book",
	"blue_car",
	"blue_heart",
	"blush",
	"boar",
	"boat",
	"bomb",
	"book",
	"bookmark",
	"bookmark_tabs",
	"books",
	"boom",
	"boot",
	"bouquet",
	"bow",
	"bowling",
	"bowtie",
	"boy",
	"bread",
	"bride_with_veil",
	"bridge_at_night",
	"briefcase",
	"broken_heart",
	"bug",
	"bulb",
	"bullettrain_front",
	"bullettrain_side",
	"bus",
	"busstop",
	"bust_in_silhouette",
	"busts_in_silhouette",
	"cactus",
	"cake",
	"calendar",
	"calling",
	"camel",
	"camera",
	"candy",
	"car",
	"card_index",
	"carousel_horse",
	"cat",
	"cat2",
	"cd",
	"chart_with_downwards_trend",
	"chart_with_upwards_trend",
	"checkered_flag",
	"cherries",
	"cherry_blossom",
	"chestnut",
	"chicken",
	"chocolate_bar",
	"christmas_tree",
	"church",
	"circus_tent",
	"city_sunrise",
	"city_sunset",
	"clap",
	"clapper",
	"clipboard",
	"closed_book",
	"closed_lock_with_key",
	"closed_umbrella",
	"cloud",
	"clubs",
	"cn",
	"cocktail",
	"coffee",
	"cold_sweat",
	"collision",
	"computer",
	"confetti_ball",
	"confounded",
	"confused",
	"construction",
	"construction_worker",
	"convenience_store",
	"cookie",
	"cop",
	"corn",
	"couple",
	"couple_with_heart",
	"couplekiss",
	"cow",
	"cow2",
	"credit_card",
	"crocodile",
	"crossed_flags",
	"crown",
	"cry",
	"crying_cat_face",
	"crystal_ball",
	"cupid",
	"curry",
	"custard",
	"cyclone",
	"dancer",
	"dancers",
	"dango",
	"dart",
	"dash",
	"date",
	"de",
	"deciduous_tree",
	"department_store",
	"diamonds",
	"disappointed",
	"disappointed_relieved",
	"dizzy",
	"dizzy_face",
	"dog",
	"dog2",
	"dollar",
	"dolls",
	"dolphin",
	"door",
	"doughnut",
	"dragon",
	"dragon_face",
	"dress",
	"dromedary_camel",
	"droplet",
	"dvd",
	"e-mail",
	"ear",
	"ear_of_rice",
	"earth_africa",
	"earth_americas",
	"earth_asia",
	"egg",
	"eggplant",
	"electric_plug",
	"elephant",
	"email",
	"envelope",
	"es",
	"euro",
	"european_castle",
	"european_post_office",
	"evergreen_tree",
	"exclamation",
	"expressionless",
	"eyeglasses",
	"eyes",
	"facepunch",
	"factory",
	"fallen_leaf",
	"family",
	"fax",
	"fearful",
	"feelsgood",
	"feet",
	"ferris_wheel",
	"file_folder",
	"finnadie",
	"fire",
	"fire_engine",
	"fireworks",
	"first_quarter_moon",
	"first_quarter_moon_with_face",
	"fish",
	"fish_cake",
	"fishing_pole_and_fish",
	"fist",
	"flags",
	"flashlight",
	"floppy_disk",
	"flower_playing_cards",
	"flushed",
	"foggy",
	"football",
	"fork_and_knife",
	"fountain",
	"four_leaf_clover",
	"fr",
	"fried_shrimp",
	"fries",
	"frog",
	"frowning",
	"fu",
	"fuelpump",
	"full_moon",
	"full_moon_with_face",
	"game_die",
	"gb",
	"gem",
	"ghost",
	"gift",
	"gift_heart",
	"girl",
	"globe_with_meridians",
	"goat",
	"goberserk",
	"godmode",
	"golf",
	"grapes",
	"green_apple",
	"green_book",
	"green_heart",
	"grey_exclamation",
	"grey_question",
	"grimacing",
	"grin",
	"grinning",
	"guardsman",
	"guitar",
	"gun",
	"haircut",
	"hamburger",
	"hammer",
	"hamster",
	"hand",
	"handbag",
	"hankey",
	"hatched_chick",
	"hatching_chick",
	"headphones",
	"hear_no_evil",
	"heart",
	"heart_eyes",
	"heart_eyes_cat",
	"heartbeat",
	"heartpulse",
	"hearts",
	"helicopter",
	"herb",
	"hibiscus",
	"high_brightness",
	"high_heel",
	"hocho",
	"honey_pot",
	"honeybee",
	"horse",
	"horse_racing",
	"hospital",
	"hotel",
	"hotsprings",
	"hourglass",
	"hourglass_flowing_sand",
	"house",
	"house_with_garden",
	"hurtrealbad",
	"hushed",
	"ice_cream",
	"icecream",
	"imp",
	"inbox_tray",
	"incoming_envelope",
	"information_desk_person",
	"innocent",
	"iphone",
	"it",
	"izakaya_lantern",
	"jack_o_lantern",
	"japan",
	"japanese_castle",
	"japanese_goblin",
	"japanese_ogre",
	"jeans",
	"joy",
	"joy_cat",
	"jp",
	"key",
	"kimono",
	"kiss",
	"kissing",
	"kissing_cat",
	"kissing_closed_eyes",
	"kissing_heart",
	"kissing_smiling_eyes",
	"koala",
	"kr",
	"last_quarter_moon",
	"last_quarter_moon_with_face",
	"laughing",
	"leaves",
	"ledger",
	"lemon",
	"leopard",
	"light_rail",
	"lips",
	"lipstick",
	"lock",
	"lock_with_ink_pen",
	"lollipop",
	"loop",
	"loudspeaker",
	"love_hotel",
	"love_letter",
	"low_brightness",
	"mag",
	"mag_right",
	"mahjong",
	"mailbox",
	"mailbox_closed",
	"mailbox_with_mail",
	"mailbox_with_no_mail",
	"man",
	"man_with_gua_pi_mao",
	"man_with_turban",
	"mans_shoe",
	"maple_leaf",
	"mask",
	"massage",
	"meat_on_bone",
	"mega",
	"melon",
	"memo",
	"metal",
	"microphone",
	"microscope",
	"milky_way",
	"minibus",
	"minidisc",
	"money_with_wings",
	"moneybag",
	"monkey",
	"monkey_face",
	"monorail",
	"moon",
	"mortar_board",
	"mount_fuji",
	"mountain_bicyclist",
	"mountain_cableway",
	"mountain_railway",
	"mouse",
	"mouse2",
	"movie_camera",
	"moyai",
	"muscle",
	"mushroom",
	"musical_keyboard",
	"musical_note",
	"musical_score",
	"mute",
	"nail_care",
	"name_badge",
	"neckbeard",
	"necktie",
	"neutral_face",
	"new_moon",
	"new_moon_with_face",
	"newspaper",
	"no_bell",
	"no_good",
	"no_mouth",
	"nose",
	"notebook",
	"notebook_with_decorative_cover",
	"notes",
	"nut_and_bolt",
	"ocean",
	"octocat",
	"octopus",
	"oden",
	"office",
	"ok_hand",
	"ok_woman",
	"older_man",
	"older_woman",
	"oncoming_automobile",
	"oncoming_bus",
	"oncoming_police_car",
	"oncoming_taxi",
	"open_file_folder",
	"open_hands",
	"open_mouth",
	"orange_book",
	"outbox_tray",
	"ox",
	"page_facing_up",
	"page_with_curl",
	"pager",
	"palm_tree",
	"panda_face",
	"paperclip",
	"partly_sunny",
	"paw_prints",
	"peach",
	"pear",
	"pencil",
	"pencil2",
	"penguin",
	"pensive",
	"performing_arts",
	"persevere",
	"person_frowning",
	"person_with_blond_hair",
	"person_with_pouting_face",
	"phone",
	"pig",
	"pig2",
	"pig_nose",
	"pill",
	"pineapple",
	"pizza",
	"point_down",
	"point_left",
	"point_right",
	"point_up",
	"point_up_2",
	"police_car",
	"poodle",
	"poop",
	"post_office",
	"postal_horn",
	"postbox",
	"pouch",
	"poultry_leg",
	"pound",
	"pouting_cat",
	"pray",
	"princess",
	"punch",
	"purple_heart",
	"purse",
	"pushpin",
	"question",
	"rabbit",
	"rabbit2",
	"racehorse",
	"radio",
	"rage",
	"rage1",
	"rage2",
	"rage3",
	"rage4",
	"railway_car",
	"rainbow",
	"raised_hand",
	"raised_hands",
	"ram",
	"ramen",
	"rat",
	"red_car",
	"relaxed",
	"relieved",
	"revolving_hearts",
	"ribbon",
	"rice",
	"rice_ball",
	"rice_cracker",
	"rice_scene",
	"ring",
	"rocket",
	"roller_coaster",
	"rooster",
	"rose",
	"rotating_light",
	"round_pushpin",
	"rowboat",
	"ru",
	"rugby_football",
	"runner",
	"running",
	"running_shirt_with_sash",
	"sailboat",
	"sake",
	"sandal",
	"santa",
	"satellite",
	"satisfied",
	"saxophone",
	"school",
	"school_satchel",
	"scissors",
	"scream",
	"scream_cat",
	"scroll",
	"seat",
	"see_no_evil",
	"seedling",
	"shaved_ice",
	"sheep",
	"shell",
	"ship",
	"shirt",
	"shit",
	"shoe",
	"shower",
	"ski",
	"skull",
	"sleeping",
	"sleepy",
	"slot_machine",
	"smile",
	"smile_cat",
	"smiley",
	"smiley_cat",
	"smiling_imp",
	"smirk",
	"smirk_cat",
	"smoking",
	"snail",
	"snake",
	"snowboarder",
	"snowflake",
	"snowman",
	"sob",
	"soccer",
	"sound",
	"space_invader",
	"spades",
	"spaghetti",
	"sparkler",
	"sparkles",
	"sparkling_heart",
	"speak_no_evil",
	"speaker",
	"speech_balloon",
	"speedboat",
	"squirrel",
	"star",
	"star2",
	"stars",
	"station",
	"statue_of_liberty",
	"steam_locomotive",
	"stew",
	"straight_ruler",
	"strawberry",
	"stuck_out_tongue",
	"stuck_out_tongue_closed_eyes",
	"stuck_out_tongue_winking_eye",
	"sun_with_face",
	"sunflower",
	"sunglasses",
	"sunny",
	"sunrise",
	"sunrise_over_mountains",
	"surfer",
	"sushi",
	"suspect",
	"suspension_railway",
	"sweat",
	"sweat_drops",
	"sweat_smile",
	"sweet_potato",
	"swimmer",
	"syringe",
	"tada",
	"tanabata_tree",
	"tangerine",
	"taxi",
	"tea",
	"telephone",
	"telephone_receiver",
	"telescope",
	"tennis",
	"tent",
	"thought_balloon",
	"thumbsdown",
	"thumbsup",
	"ticket",
	"tiger",
	"tiger2",
	"tired_face",
	"toilet",
	"tokyo_tower",
	"tomato",
	"tongue",
	"tophat",
	"tractor",
	"traffic_light",
	"train",
	"train2",
	"tram",
	"triangular_flag_on_post",
	"triangular_ruler",
	"triumph",
	"trolleybus",
	"trollface",
	"trophy",
	"tropical_drink",
	"tropical_fish",
	"truck",
	"trumpet",
	"tshirt",
	"tulip",
	"turtle",
	"tv",
	"two_hearts",
	"two_men_holding_hands",
	"two_women_holding_hands",
	"uk",
	"umbrella",
	"unamused",
	"unlock",
	"us",
	"v",
	"vertical_traffic_light",
	"vhs",
	"video_camera",
	"video_game",
	"violin",
	"volcano",
	"walking",
	"waning_crescent_moon",
	"waning_gibbous_moon",
	"warning",
	"watch",
	"water_buffalo",
	"watermelon",
	"wave",
	"waxing_crescent_moon",
	"waxing_gibbous_moon",
	"weary",
	"wedding",
	"whale",
	"whale2",
	"wind_chime",
	"wine_glass",
	"wink",
	"wolf",
	"woman",
	"womans_clothes",
	"womans_hat",
	"worried",
	"wrench",
	"yellow_heart",
	"yen",
	"yum",
	"zap",
	"zzz",
}
